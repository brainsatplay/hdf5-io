<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>hdf5-io</title>

    <!-- Browser Import (local) -->
    <!-- <script src="./dist/index.js"></script> -->

    <!-- Browser Import (remote) -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/hdf5-io"></script> -->
</head>
<body>
    <h1 style="margin-bottom: 0;">hdf5-io</h1>
    <i>Basic File Loading</i>
    <p><strong>Load Status:</strong> <span id="status"></span></p>
    <p><strong>Data Origin:</strong> <span id="origin"></span></p>
    <h3>List of File Keys</h3>
    <ul></ul>
</body>
<script type="module">
    
// import HDF5IO from './dist/index.esm.js' // ES6 Fallback
import HDF5IO from 'https://cdn.jsdelivr.net/npm/hdf5-io/dist/index.esm.js'
import * as hdf5 from "https://cdn.jsdelivr.net/npm/h5wasm@latest/dist/esm/hdf5_hl.js";

const io = new HDF5IO(hdf5, undefined, true)
console.log('HDF5IO Instance', io)

// initialize local filesystem
await io.initFS('/hdf5-io') 

// setup ui
const status = document.getElementById('status')
const origin = document.getElementById('origin')
const list = document.querySelector('ul')


// Grab a published NWB File (hdf5 backend) from a remote endpoint
const path = 'https://raw.githubusercontent.com/OpenSourceBrain/NWBShowcase/master/FergusonEtAl2015/FergusonEtAl2015.nwb'

await io.fetch(
    path, 
    undefined, 
    (ratio) => status.innerHTML = `${(ratio * 100).toFixed(2)}%`,
    (remote) => origin.innerHTML = (remote) ? path : 'Local'
)
.then(file => {
    console.log(file)
    Object.keys(file).forEach(k => list.innerHTML += `<li>${k}</li>`)
})

await io.save()

const files = await io.list()

const file = await io.read(files[0]) // get first file
console.log('File from Local Storage', file)


</script>
</html>